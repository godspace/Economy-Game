<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞: –î–∏–ª–µ–º–º–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
    
    <style>
        .text-champagne { color: var(--champagne-mist); }
        .text-yellow-green { color: var(--yellow-green); }
        .text-brick { color: var(--blushed-brick); }
        .text-sage { color: var(--sage-green); }
        .bg-hunter { background-color: var(--hunter-green); }
        .bg-sage { background-color: var(--sage-green); }
        .border-sage { border-color: var(--sage-green); }
        .border-brick { border-color: var(--blushed-brick); }
        .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .animate-bounce-slow { animation: bounce-slow 2s infinite; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes bounce-slow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-4 pt-8 bg-[#386641] pb-24">

    <div id="snow-container"></div>

    <div id="login-screen" class="glass-panel p-6 max-w-sm w-full z-10 flex flex-col gap-6 my-auto">
        <div class="text-center">
            <h1 class="text-4xl font-bold text-brick mb-2">üéÖ –í—Ö–æ–¥</h1>
            <p class="text-sm text-champagne opacity-80">–í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ —ç–ª—å—Ñ–∞</p>
        </div>
        <div>
            <input type="text" id="access-code" maxlength="6" placeholder="–ö–æ–¥..." 
                   class="w-full p-4 rounded-xl bg-[#2a4d31] border border-[#6a994e] text-center text-2xl text-champagne mb-4 focus:outline-none focus:border-[#a7c957] tracking-[0.2em] placeholder-opacity-30 placeholder-[#f2e8cf]">
            <button id="login-btn" class="btn-primary w-full py-4 rounded-xl shadow-lg text-lg uppercase tracking-wider">–í–æ–π—Ç–∏ –≤ –∏–≥—Ä—É</button>
            <p id="login-error" class="text-brick mt-2 text-sm text-center hidden font-bold"></p>
        </div>
        <div class="border-t border-[#6a994e] pt-4">
            <h3 class="text-center text-yellow-green font-bold mb-3 text-sm uppercase tracking-widest">üèÜ –õ–∏–¥–µ—Ä—ã —à–∫–æ–ª—ã</h3>
            <table class="ranking-table" id="login-leaderboard"></table>
        </div>
    </div>

    <div id="game-screen" class="hidden w-full max-w-2xl z-10">
        
        <div class="glass-panel p-5 mb-5 flex justify-between items-start shadow-xl">
            <div>
                <div id="my-name" class="text-xs text-sage font-bold uppercase tracking-wider">–ò–≥—Ä–æ–∫</div>
                <div class="text-3xl font-bold text-yellow-green drop-shadow-sm mt-1">üí∞ <span id="my-coins">0</span></div>
            </div>
            <div class="flex flex-col items-end gap-2">
                <div class="text-right">
                    <div class="text-xs text-sage font-bold uppercase tracking-wider">–í–∞—à –∫–ª–∞—Å—Å</div>
                    <div class="font-bold text-xl text-champagne" id="my-class">--</div>
                </div>
                <button onclick="logout()" class="text-[10px] uppercase font-bold text-brick border border-brick hover:bg-brick hover:text-white px-3 py-1 rounded-full transition">–í—ã–π—Ç–∏ üö™</button>
            </div>
        </div>

        <div class="flex justify-center mb-6 space-x-2 bg-[#2a4d31] p-2 rounded-xl shadow-inner overflow-x-auto sticky top-2 z-40 border border-[#6a994e]/50 backdrop-blur">
            <button onclick="switchTab('game')" id="tab-btn-game" class="tab-btn active text-sm flex-1 min-w-[70px] py-2 rounded-lg">üéÑ –ò–ì–†–ê</button>
            <button onclick="switchTab('shop')" id="tab-btn-shop" class="tab-btn text-sm flex-1 min-w-[70px] py-2 rounded-lg">üç´ –®–û–ü</button>
            <button onclick="switchTab('bank')" id="tab-btn-bank" class="tab-btn text-sm flex-1 min-w-[70px] py-2 rounded-lg">üè¶ –ë–ê–ù–ö</button>
            <button onclick="switchTab('rating')" id="tab-btn-rating" class="tab-btn text-sm flex-1 min-w-[70px] py-2 rounded-lg">üèÜ –¢–û–ü</button>
            <button onclick="switchTab('admin')" id="tab-btn-admin" class="tab-btn text-sm flex-1 hidden text-brick font-bold border-brick min-w-[70px] py-2 rounded-lg">ADMIN</button>
        </div>

        <div id="tab-content-game">
            <div id="incoming-deals" class="mb-6 space-y-4"></div>
            <div class="flex items-center justify-between mb-4 px-2">
                <h2 class="text-base font-bold text-champagne uppercase tracking-widest opacity-70">–ê–Ω–æ–Ω–∏–º–Ω—ã–µ —ç–ª—å—Ñ—ã</h2>
                <span class="text-xs text-yellow-green bg-[#2a4d31] px-3 py-1 rounded-full border border-[#6a994e]">–õ–∏–º–∏—Ç: 5</span>
            </div>
            <div id="players-list" class="grid grid-cols-1 gap-4"></div>
        </div>

        <div id="tab-content-shop" class="hidden">
            <div class="glass-panel p-8 text-center">
                <h2 class="text-2xl font-bold text-champagne mb-8">–õ–µ—Å–Ω–∞—è –õ–∞–≤–∫–∞</h2>
                <div class="bg-[#2a4d31] p-6 rounded-2xl border-2 border-[#6a994e] shadow-xl max-w-sm mx-auto relative group">
                    <div class="text-7xl mb-6 transform group-hover:scale-110 transition duration-300">üç´</div>
                    <h3 class="text-2xl font-bold text-champagne mb-2">Baunty</h3>
                    <p class="text-sage text-sm mb-6 font-bold">–†–∞–π—Å–∫–æ–µ –Ω–∞—Å–ª–∞–∂–¥–µ–Ω–∏–µ</p>
                    <div class="text-4xl font-bold text-yellow-green mb-6">99 üí∞</div>
                    <button id="btn-buy-bounty" onclick="buyItem('Baunty', 99)" class="btn-primary w-full py-4 rounded-xl text-xl shadow-lg active:scale-95">–ö–£–ü–ò–¢–¨</button>
                    <p id="shop-status" class="text-sm text-yellow-green mt-4 font-bold bg-[#386641] p-3 rounded-lg hidden border border-[#a7c957]">üì¶ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –ñ–¥–∏—Ç–µ –≤—ã–¥–∞—á–∏.</p>
                </div>
            </div>
        </div>

        <div id="tab-content-bank" class="hidden space-y-6">
            
            <div id="incoming-transfers" class="space-y-3"></div>

            <button onclick="openTransferModal()" class="w-full py-4 rounded-2xl bg-gradient-to-r from-[#60a846] to-[#4a7036] hover:brightness-110 text-[#fffdf5] font-bold text-lg uppercase shadow-lg border-2 border-[#fffdf5]/20 flex items-center justify-center gap-3 transition active:scale-95 group relative overflow-hidden">
                <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition"></div>
                <span class="text-2xl">üí∏</span>
                <span>–ü–ï–†–ï–í–û–î –î–†–£–ì–£</span>
            </button>

            <div class="glass-panel p-6 flex flex-col gap-4">
                <div class="flex justify-between items-center border-b border-[#6a994e]/30 pb-4">
                    <div class="text-xs text-sage font-bold uppercase tracking-widest">–ú–æ–∏ –≤–∫–ª–∞–¥—ã</div>
                    <div class="bg-[#0f1c11] px-3 py-1 rounded-lg border border-sage/30">
                        <span id="active-invest-count" class="text-yellow-green font-bold text-lg">0</span>
                        <span class="text-[10px] text-sage ml-1">–ê–ö–¢–ò–í–ù–´–•</span>
                    </div>
                </div>
                <div id="my-investments-list" class="space-y-3 min-h-[50px]"></div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div onclick="openInvestModal('call', '–ü–æ –∑–≤–æ–Ω–∫—É', '45 –º–∏–Ω', '3%')" class="bg-[#2a4d31] p-4 rounded-xl border border-[#6a994e] hover:bg-[#386641] transition cursor-pointer h-32 flex flex-col justify-between relative overflow-hidden group">
                    <div class="absolute -right-2 -top-2 text-4xl opacity-10 group-hover:opacity-20 transition">üîî</div>
                    <div class="text-3xl">üîî</div> 
                    <div>
                        <div class="text-yellow-green font-bold leading-tight">–ü–æ –∑–≤–æ–Ω–∫—É</div>
                        <div class="text-[10px] text-sage font-bold mt-1">–ú–∏–Ω. 34 üí∞</div>
                    </div>
                    <div class="text-right text-xl font-bold text-champagne">+3%</div>
                </div>
                <div onclick="openInvestModal('five', '–ü—è—Ç—ë—Ä–∫–∞', '6 —á–∞—Å–æ–≤', '5%')" class="bg-[#2a4d31] p-4 rounded-xl border border-[#6a994e] hover:bg-[#386641] transition cursor-pointer h-32 flex flex-col justify-between">
                    <div class="text-3xl">üñêÔ∏è</div>
                    <div>
                        <div class="text-yellow-green font-bold leading-tight">–ü—è—Ç—ë—Ä–∫–∞</div>
                        <div class="text-[10px] text-sage font-bold mt-1">–ú–∏–Ω. 20 üí∞</div>
                    </div>
                    <div class="text-right text-xl font-bold text-champagne">+5%</div>
                </div>
                <div onclick="openInvestModal('night', '–ù–æ—á—å', '12 —á–∞—Å–æ–≤', '10%')" class="bg-[#2a4d31] p-4 rounded-xl border border-[#6a994e] hover:bg-[#386641] transition cursor-pointer h-32 flex flex-col justify-between">
                    <div class="text-3xl">üåô</div>
                    <div>
                        <div class="text-yellow-green font-bold leading-tight">–ù–æ—á—å</div>
                        <div class="text-[10px] text-sage font-bold mt-1">–ú–∏–Ω. 10 üí∞</div>
                    </div>
                    <div class="text-right text-xl font-bold text-champagne">+10%</div>
                </div>
                <div onclick="openInvestModal('champion', '–ß–µ–º–ø–∏–æ–Ω', '24 —á–∞—Å–∞', '20%')" class="bg-gradient-to-br from-[#2a4d31] to-[#1a2f1d] p-4 rounded-xl border border-[#e9c46a] shadow-lg hover:scale-[1.02] transition cursor-pointer h-32 flex flex-col justify-between relative">
                    <div class="absolute -right-2 -top-2 text-yellow-green opacity-20 text-5xl">üèÜ</div>
                    <div class="text-3xl">üèÜ</div>
                    <div>
                        <div class="text-yellow-green font-bold leading-tight">–ß–µ–º–ø–∏–æ–Ω</div>
                        <div class="text-[10px] text-sage font-bold mt-1">–ú–∏–Ω. 5 üí∞</div>
                    </div>
                    <div class="text-right text-xl font-bold text-champagne">+20%</div>
                </div>
                <div onclick="openInvestModal('crypto', 'Crypto SCAM', '45 –º–∏–Ω', '???')" class="col-span-2 bg-[#2b1114] p-4 rounded-xl border-2 border-brick shadow-[0_0_10px_rgba(214,64,69,0.3)] hover:scale-[1.01] transition cursor-pointer flex items-center justify-between relative overflow-hidden animate-pulse-slow">
                    <div class="flex items-center gap-3 relative z-10">
                        <div class="text-3xl">üíÄ</div>
                        <div>
                            <div class="text-brick font-bold">CRYPTO RISK</div>
                            <div class="text-[10px] text-brick/70">–ü–∞–Ω –∏–ª–∏ –ø—Ä–æ–ø–∞–ª</div>
                        </div>
                    </div>
                    <div class="text-xl font-bold text-champagne relative z-10">X0..X2.5</div>
                </div>
            </div>
        </div>

        <div id="tab-content-rating" class="hidden glass-panel p-6">
            <h2 class="text-center text-yellow-green font-bold mb-6 text-lg uppercase tracking-widest">–†–µ–π—Ç–∏–Ω–≥ —à–∫–æ–ª—ã</h2>
            <div class="overflow-x-auto">
                <table class="ranking-table w-full text-left" id="main-leaderboard">
                    <thead><tr class="text-xs text-sage uppercase"><th class="p-3">#</th><th class="p-3">–ò–º—è</th><th class="p-3">–ö–ª–∞—Å—Å</th><th class="p-3 text-right">Coins</th></tr></thead>
                    <tbody class="text-base"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-content-admin" class="hidden glass-panel p-4 border-brick">
            <div class="flex justify-between items-center mb-4 border-b border-[#6a994e] pb-2">
                <h2 class="text-brick font-bold uppercase text-sm">üì¶ –ó–∞–∫–∞–∑—ã</h2>
                <button onclick="loadAdminOrders()" class="text-xs bg-[#2a4d31] hover:bg-[#386641] px-4 py-2 rounded-lg text-champagne">–û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <div id="admin-orders-list" class="space-y-3"></div>
        </div>
    </div>

    <div id="modal-move" class="fixed inset-0 bg-[#0f1c11]/95 hidden items-center justify-center z-50 p-4">
        <div class="glass-panel p-6 w-full max-w-sm text-center bg-[#2a4d31] border-[#a7c957] flex flex-col h-[80vh]">
            <h3 id="modal-title" class="text-2xl mb-3 text-champagne font-bold flex-shrink-0">–í–∞—à –≤—ã–±–æ—Ä?</h3>
            <div class="flex-grow overflow-y-auto mb-6 bg-[#1f3a24] rounded-xl p-3 border border-[#386641] shadow-inner">
                <div class="text-xs text-sage uppercase tracking-widest mb-3 sticky top-0 bg-[#1f3a24] py-1 font-bold z-10">–ò—Å—Ç–æ—Ä–∏—è</div>
                <div id="modal-history-list" class="space-y-2 text-sm"></div>
            </div>
            <p id="modal-tips" class="text-sm text-champagne/70 mb-6 px-2 flex-shrink-0 leading-relaxed"><span class="text-yellow-green font-bold">–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ:</span> +2 / +2<br><span class="text-brick font-bold">–û–±–º–∞–Ω:</span> –≤—ã +3, –æ–Ω -1</p>
            <div id="modal-actions" class="grid grid-cols-2 gap-4 flex-shrink-0">
                <button onclick="makeMove('cooperate')" class="py-4 rounded-xl bg-[#6a994e] hover:bg-[#588540] text-[#1f3a24] font-bold text-lg shadow-lg active:scale-95 border-b-4 border-[#4a7036]">ü§ù –î—Ä—É–∂–±–∞</button>
                <button onclick="makeMove('defect')" class="py-4 rounded-xl bg-[#bc4749] hover:bg-[#a33a3c] text-champagne font-bold text-lg shadow-lg active:scale-95 border-b-4 border-[#8f3234]">üòà –û–±–º–∞–Ω</button>
            </div>
            <button onclick="closeModal()" class="mt-6 text-sage text-sm hover:text-champagne underline flex-shrink-0 transition">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="modal-invest" class="fixed inset-0 bg-[#0f1c11]/95 hidden items-center justify-center z-50 p-4">
        <div class="glass-panel p-6 w-full max-w-sm bg-[#2a4d31] border-[#a7c957]">
            <h3 id="invest-title" class="text-2xl font-bold text-champagne mb-2 text-center">–ù–∞–∑–≤–∞–Ω–∏–µ</h3>
            <p class="text-center text-sage mb-6 text-sm">–ü—Ä–∏–±—ã–ª—å: <span id="invest-percent" class="font-bold text-yellow-green"></span></p>
            <input type="number" id="invest-amount" class="w-full p-4 rounded-xl bg-[#1f3a24] border border-[#6a994e] text-center text-xl text-champagne mb-4 focus:outline-none focus:border-[#a7c957]" placeholder="–°—É–º–º–∞">
            <button onclick="confirmInvest()" class="btn-primary w-full py-4 rounded-xl text-lg shadow-lg active:scale-95">–í–ù–ï–°–¢–ò</button>
            <button onclick="document.getElementById('modal-invest').classList.add('hidden'); document.getElementById('modal-invest').classList.remove('flex')" class="w-full mt-4 text-sage text-sm underline">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <div id="modal-transfer" class="fixed inset-0 bg-[#0f1c11]/95 hidden items-center justify-center z-50 p-4">
        <div class="glass-panel p-6 w-full max-w-sm bg-[#2a4d31] border-[#a7c957]">
            <h3 class="text-2xl font-bold text-champagne mb-6 text-center">üí∏ –ü–µ—Ä–µ–≤–æ–¥</h3>
            <label class="block text-xs text-sage font-bold uppercase mb-2 ml-1">1. –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</label>
            <select id="transfer-class" onchange="filterTransferStudents()" class="w-full p-3 rounded-xl bg-[#1f3a24] border border-[#6a994e] text-champagne mb-4 focus:outline-none">
                <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
            </select>
            <label class="block text-xs text-sage font-bold uppercase mb-2 ml-1">2. –í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞</label>
            <select id="transfer-student" disabled class="w-full p-3 rounded-xl bg-[#1f3a24] border border-[#6a994e]/50 text-champagne mb-4 focus:outline-none disabled:opacity-50">
                <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</option>
            </select>
            <label class="block text-xs text-sage font-bold uppercase mb-2 ml-1">–°—É–º–º–∞</label>
            <input type="number" id="transfer-amount" class="w-full p-3 rounded-xl bg-[#1f3a24] border border-[#6a994e] text-center text-lg text-champagne mb-6 focus:outline-none" placeholder="0">
            <button onclick="confirmTransfer()" class="btn-primary w-full py-4 rounded-xl text-lg shadow-lg active:scale-95">–û–¢–ü–†–ê–í–ò–¢–¨</button>
            <button onclick="document.getElementById('modal-transfer').classList.add('hidden'); document.getElementById('modal-transfer').classList.remove('flex')" class="w-full mt-4 text-sage text-sm underline">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>