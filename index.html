<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Эволюция доверия</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-handshake"></i>
                    <div>
                        <h1>Эволюция доверия</h1>
                        <p class="subtitle">Создавай сделки, зарабатывай монеты и повышай репутацию!</p>
                    </div>
                </div>
                <div id="userInfo" style="display: none;">
                    <button id="logoutBtn" class="btn-outline btn-small">
                        <i class="fas fa-sign-out-alt"></i> Выйти
                    </button>
                </div>
            </div>
        </header>

        <div id="loadingMessage" class="loading">
            <div class="spinner"></div>
            <p>Загрузка приложения...</p>
        </div>

        <div id="errorMessage" class="error-message" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Произошла ошибка при загрузке приложения. Пожалуйста, обновите страницу.</p>
        </div>

        <!-- Секция аутентификации -->
        <section id="authSection" class="auth-section active">
            <div class="card">
                <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <i class="fas fa-user"></i> Вход / Регистрация
                </h2>
                <div id="authError" class="error-message" style="display: none;"></div>
                <form id="authForm">
                    <div class="form-group">
                        <label for="username"><i class="fas fa-user-tag"></i> Никнейм</label>
                        <input type="text" id="username" placeholder="Введите ваш никнейм" required>
                    </div>
                    <div class="form-group">
                        <label for="password"><i class="fas fa-lock"></i> Пароль</label>
                        <input type="password" id="password" placeholder="Введите пароль" required>
                    </div>
                    <div class="form-group">
                        <label for="class"><i class="fas fa-users"></i> Класс</label>
                        <select id="class" required>
                            <option value="">Выберите класс</option>
                            <option value="5А">5А</option>
                            <option value="5Б">5Б</option>
                            <option value="5В">5В</option>
                            <option value="5Г">5Г</option>
                            <option value="6А">6А</option>
                            <option value="6Б">6Б</option>
                            <option value="6В">6В</option>
                            <option value="6Г">6Г</option>
                            <option value="6Д">6Д</option>
                            <option value="7А">7А</option>
                            <option value="7Б">7Б</option>
                            <option value="8А">8А</option>
                            <option value="8Б">8Б</option>
                            <option value="8В">8В</option>
                            <option value="9А">9А</option>
                            <option value="9Б">9Б</option>
                            <option value="9В">9В</option>
                            <option value="10А">10А</option>
                            <option value="10Б">10Б</option>
                            <option value="11">11</option>
                        </select>
                    </div>
                    <button type="submit" id="authBtn">
                        <i class="fas fa-sign-in-alt"></i> Войти / Зарегистрироваться
                    </button>
                </form>
            </div>
            
            <!-- Добавлен рейтинг на страницу авторизации -->
            <div class="card">
                <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <i class="fas fa-trophy"></i> Топ-10 игроков
                </h2>
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th>Место</th>
                            <th>Игрок</th>
                            <th>Класс</th>
                            <th>Монеты</th>
                            <th>Репутация</th>
                        </tr>
                    </thead>
                    <tbody id="topRankingTable">
                        <!-- Топ-10 рейтинга будет загружен здесь -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Секция профиля -->
        <section id="profileSection" class="profile-section">
            <div class="user-info">
                <div class="user-info-avatar" id="userAvatar"></div>
                <div>
                    <h3 id="userGreeting">Привет, игрок!</h3>
                    <!-- Убрано отображение класса здесь -->
                </div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="stat-label">Монеты</div>
                    <div class="stat-value" id="coinsValue">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-label">Репутация</div>
                    <div class="stat-value" id="reputationValue">0</div>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="users">
                    <i class="fas fa-users"></i> Игроки
                </div>
                <div class="tab" data-tab="deals">
                    <i class="fas fa-handshake"></i> Мои сделки
                </div>
                <div class="tab" data-tab="investments">
                    <i class="fas fa-piggy-bank"></i> Мои вклады
                </div>
                <div class="tab" data-tab="ranking">
                    <i class="fas fa-trophy"></i> Рейтинг
                </div>
            </div>

            <div class="tab-content active" id="usersTab">
                <div class="card">
                    <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-search"></i> Поиск игроков
                    </h2>
                    <div class="search-container">
                        <div class="form-group search-input">
                            <input type="text" id="searchInput" placeholder="Введите имя пользователя">
                        </div>
                        <div class="form-group" style="min-width: 150px;">
                            <select id="classFilter">
                                <option value="">Все классы</option>
                                <option value="5А">5А</option>
                                <option value="5Б">5Б</option>
                                <option value="5В">5В</option>
                                <option value="5Г">5Г</option>
                                <option value="6А">6А</option>
                                <option value="6Б">6Б</option>
                                <option value="6В">6В</option>
                                <option value="6Г">6Г</option>
                                <option value="6Д">6Д</option>
                                <option value="7А">7А</option>
                                <option value="7Б">7Б</option>
                                <option value="8А">8А</option>
                                <option value="8Б">8Б</option>
                                <option value="8В">8В</option>
                                <option value="9А">9А</option>
                                <option value="9Б">9Б</option>
                                <option value="9В">9В</option>
                                <option value="10А">10А</option>
                                <option value="10Б">10Б</option>
                                <option value="11">11</option>
                            </select>
                        </div>
                    </div>
                    <button id="searchBtn">
                        <i class="fas fa-search"></i> Поиск
                    </button>
                </div>

                <div class="card">
                    <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-users"></i> Список игроков
                    </h2>
                    <div id="usersList" class="user-list">
                        <!-- Список пользователей будет загружен здесь -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="dealsTab">
                <div class="card">
                    <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-inbox"></i> Входящие сделки
                    </h2>
                    <div id="incomingDeals">
                        <!-- Входящие сделки будут загружены здесь -->
                    </div>
                </div>

                <div class="card">
                    <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-clock"></i> Ожидающие ответа
                    </h2>
                    <div id="pendingDeals">
                        <!-- Ожидающие ответа сделки будут загружены здесь -->
                    </div>
                </div>

                <!-- ЗАМЕНЕН РАЗДЕЛ "Все сделки" на "Завершённые сделки" -->
                <div class="card">
                    <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-history"></i> Завершённые сделки
                    </h2>
                    <div class="completed-deals-container">
                        <div class="deals-column">
                            <h3 style="margin-bottom: 15px; color: var(--primary);">
                                <i class="fas fa-download"></i> Входящие
                            </h3>
                            <div id="completedIncomingDeals">
                                <!-- Завершённые входящие сделки будут загружены здесь -->
                            </div>
                        </div>
                        <div class="deals-column">
                            <h3 style="margin-bottom: 15px; color: var(--primary);">
                                <i class="fas fa-upload"></i> Исходящие
                            </h3>
                            <div id="completedOutgoingDeals">
                                <!-- Завершённые исходящие сделки будут загружены здесь -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="investmentsTab">
                <div class="card">
                    <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <i class="fas fa-piggy-bank"></i> Мои вклады
                    </h2>
                    
                    <div class="active-deposits">
                        <h3 style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <i class="fas fa-clock"></i> Активные вклады
                        </h3>
                        <div id="activeDepositsList">
                            <!-- Активные вклады будут загружены здесь -->
                        </div>
                    </div>
                    
                    <!-- Перемещен раздел с вкладами перед историей -->
                    <div class="deposit-category">
                        <h3><i class="fas fa-shield-alt"></i> Безрисковые вклады (гарантированная доходность)</h3>
                        <p style="margin-bottom: 15px; color: var(--gray);">Идеальны для стабильного роста. Чем дольше срок — тем выше прибыль.</p>
                        
                        <div class="deposit-options">
                            <div class="deposit-option safe">
                                <div class="deposit-header">
                                    <div class="deposit-name">«По звонку»</div>
                                    <div class="deposit-duration">45 минут</div>
                                </div>
                                <div class="deposit-profit">Доходность: +3%</div>
                                <div class="deposit-description">
                                    Сделай вклад перед уроком — забери прибыль после звонка.
                                </div>
                                <div class="deposit-example">
                                    <strong>Пример:</strong> 100 монет → <span class="profit-positive">103 монеты</span>
                                </div>
                                <button class="btn-success open-deposit" data-type="call" data-duration="45" data-profit="3">
                                    <i class="fas fa-lock-open"></i> Открыть вклад
                                </button>
                            </div>
                            
                            <div class="deposit-option safe">
                                <div class="deposit-header">
                                    <div class="deposit-name">«Спокойная ночь»</div>
                                    <div class="deposit-duration">12 часов</div>
                                </div>
                                <div class="deposit-profit">Доходность: +8%</div>
                                <div class="deposit-description">
                                    Вложи перед сном — утром получи прибыль перед школой.
                                </div>
                                <div class="deposit-example">
                                    <strong>Пример:</strong> 100 монets → <span class="profit-positive">108 монет</span>
                                </div>
                                <button class="btn-success open-deposit" data-type="night" data-duration="720" data-profit="8">
                                    <i class="fas fa-lock-open"></i> Открыть вклад
                                </button>
                            </div>
                            
                            <div class="deposit-option safe">
                                <div class="deposit-header">
                                    <div class="deposit-name">«Чемпион»</div>
                                    <div class="deposit-duration">24 часа</div>
                                </div>
                                <div class="deposit-profit">Доходность: +15%</div>
                                <div class="deposit-description">
                                    Для самых терпеливых. Максимальная надёжность и доход за сутки.
                                </div>
                                <div class="deposit-example">
                                    <strong>Пример:</strong> 100 монет → <span class="profit-positive">115 монет</span>
                                </div>
                                <button class="btn-success open-deposit" data-type="champion" data-duration="1440" data-profit="15">
                                    <i class="fas fa-lock-open"></i> Открыть вклад
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="deposit-category">
                        <h3><i class="fas fa-dice"></i> Рисковые вклады (высокая доходность с риском потери)</h3>
                        <p style="margin-bottom: 15px; color: var(--gray);">Подходят для азартных игроков. При удаче — крупный выигрыш, при неудаче — потери.</p>
                        
                        <div class="deposit-options">
                            <div class="deposit-option risky">
                                <div class="deposit-header">
                                    <div class="deposit-name">«Крипта»</div>
                                    <div class="deposit-duration">45 минут</div>
                                </div>
                                <div class="deposit-description">
                                    Рискни на перемене! Сможешь ли ты обогнать одноклассников?
                                </div>
                                <div style="margin: 10px 0;">
                                    <div><span class="profit-positive">Доходность: +20% с вероятностью 40%</span></div>
                                    <div><span class="profit-negative">Убыточность: -10% с вероятностью 60%</span></div>
                                </div>
                                <div class="deposit-example">
                                    <strong>Примеры:</strong><br>
                                    <span class="profit-positive">Удача: 100 монет → 120 монет</span><br>
                                    <span class="profit-negative">Провал: 100 монет → 90 монет</span>
                                </div>
                                <button class="btn-warning open-deposit" data-type="crypto" data-duration="45" data-profit="20" data-risk="true">
                                    <i class="fas fa-dice"></i> Испытать удачу
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- История вкладов перенесена в конец -->
                    <div class="deposit-history">
                        <h3 style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <i class="fas fa-history"></i> История вкладов
                        </h3>
                        <div id="depositHistoryList">
                            <!-- История вкладов будет загружена здесь -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="rankingTab">
                <div class="card">
                    <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-trophy"></i> Рейтинг игроков
                    </h2>
                    <table class="ranking-table">
                        <thead>
                            <tr>
                                <th>Место</th>
                                <th>Игрок</th>
                                <th>Класс</th>
                                <th>Монеты</th>
                                <th>Репутация</th>
                            </tr>
                        </thead>
                        <tbody id="rankingTable">
                            <!-- Рейтинг будет загружен здесь -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <!-- Модальное окно сделки -->
    <div id="dealModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                <i class="fas fa-handshake"></i> Предложить сделку
            </h2>
            <div class="user-info">
                <div class="user-avatar" id="dealAvatar"></div>
                <div>
                    <h3 id="dealPlayerName">Игрок</h3>
                    <p id="dealPlayerClass">Класс: -</p>
                </div>
            </div>
            <div class="user-details" style="justify-content: space-around; margin: 20px 0;">
                <div class="user-detail">
                    <i class="fas fa-coins"></i>
                    <span id="dealPlayerCoins">0</span>
                </div>
                <div class="user-detail">
                    <i class="fas fa-star"></i>
                    <span id="dealPlayerReputation">0</span>
                </div>
            </div>
            
            <div class="deal-info">
                <h3 style="margin-bottom: 10px;">Выберите вашу стратегию:</h3>
                <p><i class="fas fa-check-circle" style="color: var(--success);"></i> <strong>Сотрудничать:</strong> Оба игрока получают по 2 монеты</p>
                <p><i class="fas fa-times-circle" style="color: var(--danger);"></i> <strong>Жульничать:</strong> Вы получаете 3 монеты, другой игрок теряет 1 монету</p>
                <p style="margin-top: 10px; font-style: italic;">Но будьте осторожны - если оба выберут "Жульничать", оба теряют по 1 монете!</p>
            </div>
            
            <div id="dealLimitInfo" class="deal-limit-info" style="display: none;">
                <i class="fas fa-info-circle"></i>
                <span id="dealLimitText">Вы уже совершили 0 из 5 возможных сделок с этим игроком сегодня.</span>
            </div>
            
            <div class="choice-buttons">
                <button id="cooperateBtn" class="btn-success">
                    <i class="fas fa-handshake"></i> Сотрудничать
                </button>
                <button id="cheatBtn" class="btn-danger">
                    <i class="fas fa-user-secret"></i> Жульничать
                </button>
            </div>
        </div>
    </div>

    <!-- Модальное окно ответа на сделку -->
    <div id="responseModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                <i class="fas fa-reply"></i> Ответить на сделку
            </h2>
            <div id="responseDealInfo">
                <!-- Информация о сделке будет загружена здесь -->
            </div>
            
            <div class="choice-buttons">
                <button id="respondCooperateBtn" class="btn-success">
                    <i class="fas fa-handshake"></i> Сотрудничать
                </button>
                <button id="respondCheatBtn" class="btn-danger">
                    <i class="fas fa-user-secret"></i> Жульничать
                </button>
            </div>
        </div>
    </div>

    <!-- Модальное окно результата сделки -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                <i class="fas fa-chart-line"></i> Результат сделки
            </h2>
            <div id="resultContent">
                <!-- Результат сделки будет загружен здесь -->
            </div>
            <button id="closeResultBtn" style="margin-top: 20px;">
                <i class="fas fa-check"></i> Понятно
            </button>
        </div>
    </div>

    <!-- Модальное окно открытия вклада -->
    <div id="depositModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                <i class="fas fa-piggy-bank"></i> Открытие вклада
            </h2>
            <div id="depositModalContent">
                <!-- Содержимое модального окна вклада будет заполнено динамически -->
            </div>
        </div>
    </div>

    <!-- Модальное окно результата вклада -->
    <div id="depositResultModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                <i class="fas fa-chart-line"></i> Результат вклада
            </h2>
            <div id="depositResultContent">
                <!-- Результат вклада будет загружен здесь -->
            </div>
            <button id="closeDepositResultBtn" style="margin-top: 20px;">
                <i class="fas fa-check"></i> Понятно
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>